#!/usr/bin/env node

// Dependencies
var assert = require('assert');

var data = {};

// Load basic info.
data.tracks = require('../data/tracks.json');
data.artists = require('../data/artists.json');
data.individuals = require('../data/individuals.json');
data.releases = require('../data/releases.json');

// Load relation data
data.at = require('../data/artist_track.json');
data.ia = require('../data/individual_artist.json');
data.it = require('../data/individual_track.json');
data.tr = require('../data/track_release.json');

// Store keys object since I think we'll need it a lot.
data.keys = Object.keys(data);

assert.equal(data.keys.length, 8, 'data.keys has unexpected length: ' + data.keys.length);

data.keys.forEach(function(key) {
    assert.ok(data[key].length, 'data.' + key + ' has zero or undefined length');
});

//Confirm that all artists appear in artist_track.
assert.ok(data.artists.every(function (artistsValue) {
    return data.at.some( function (atValue) {
        return atValue.artistId === artistsValue.id;
    });
}));

// Check that all instances of basic are included in relation as propName.
// For example, all instances of 'artists' included in 'at' as 'artistId'
data.included = function (basic, relation, propName) {
    return data[basic].every( function (basicValue) {
        return data[relation].some( function (relationValue) {
            return relationValue[propName] === basicValue.id;
        });
    });
};

// All artists should have tracks.
assert.ok(data.included('artists', 'at', 'artistId'));
// All tracks should have artists.
assert.ok(data.included('tracks', 'at', 'trackId'));
// All artists have individuals. (Not all individuals are members of artists, though.)
//assert.ok(data.included('artists', 'ia', 'artistId'));
// All individuals are associated with at least one track.
//assert.ok(data.included('individuals', 'it', 'individualId'));
// All tracks are on at least one release.
assert.ok(data.included('tracks', 'tr', 'trackId'));
// All releases have at least one track.
assert.ok(data.included('releases', 'tr', 'releaseId'));
